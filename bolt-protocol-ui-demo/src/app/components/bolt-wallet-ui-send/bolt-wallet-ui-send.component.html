<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Send sBTC</h2>
      <button class="close-button" (click)="closeModal()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="modal-content">
      @if (isProcessing) {
        <div class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Processing transaction...</p>
        </div>
      } @else {
        <form class="transfer-form" (ngSubmit)="onSubmit()">
          <div class="balance-info">
            <span class="label">Available Balance</span>
            <span class="value">{{ formatBalanceForDisplay(boltWalletBalance) }}</span>
          </div>

          <div class="input-group">
            <label>Amount (sat)</label>
            <div class="amount-input">
              <input type="text"
                     [ngModel]="amount.toString()"
                     [ngModelOptions]="{standalone: true}"
                     placeholder="0"
                     (keypress)="validateAmount($event)"
                     (input)="onAmountInput($event)"
                     inputmode="numeric"
                     pattern="[0-9]*"
                     min="0">
              <button type="button" class="btn-max" (click)="setMaxAmount()">MAX</button>
            </div>
            @if (amount > 0) {
              <small class="amount-preview">
                = {{ amount | tokenAmount:'sBTC' }} sBTC
              </small>
            }
            @if (exceedsBalance) {
              <small class="error-message">
                Insufficient balance
              </small>
            }
            <small class="fee-info">
              Fee: {{ getFee() }} sat
            </small>
          </div>

          <div class="input-group">
            <label>Recipient Address</label>
            <div class="address-input">
              <input type="text" [(ngModel)]="recipientAddress" [ngModelOptions]="{standalone: true}"
                     placeholder="Enter recipient address">
            </div>
          </div>

          <div class="input-group">
            <label>Memo (optional)</label>
            <div class="address-input">
              <input type="text" [(ngModel)]="memo" [ngModelOptions]="{standalone: true}"
                     placeholder="Add a message (optional)" maxlength="100">
            </div>
            <small class="memo-info" *ngIf="memo">
              Your message will be stored on the blockchain
            </small>
          </div>

          <div class="action-buttons">
            <button type="button" class="cancel-button" (click)="closeModal()">
              Cancel
            </button>
            <button type="submit" class="submit-button" [disabled]="!amount || !recipientAddress || isProcessing || exceedsBalance">
              Send
            </button>
          </div>
        </form>
      }
    </div>
  </div>
</div>
